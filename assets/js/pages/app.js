"use strict";var express=require("express"),path=require("path"),bodyParser=require("body-parser"),mysql=require("mysql2"),multer=require("multer"),upload=multer(),app=express(),port=3e3;app.use(bodyParser.urlencoded({extended:!1})),app.use(bodyParser.json());var db=mysql.createConnection({host:"localhost",user:"root",password:"Abhayraj@1111",database:"login_db"});db.connect(function(e){if(e)throw e;console.log("Mysql connected...")}),app.use(express.static(path.join(__dirname))),app.get("/",function(e,r){r.sendFile(path.join(__dirname,"../../html/login.html"))}),app.post("/login",function(e,s){var r=e.body,e=r.username,r=r.password;db.query("SELECT * FROM User WHERE username = ? AND password = ?",[e,r],function(e,r){return e?(console.error("Error during query:",e),void s.sendFile(path.join(__dirname,"error-500.html"))):void(0<r.length?s.json({success:!0}):s.status(401).json({success:!1,message:"Invalid credentials"}))})}),app.post("/add_user",upload.none(),function(e,s){var r=e.body,o=r.fullName,a=r.username,t=r.email,n=r.password,e=r.confirmPassword,r=r.mobile;n===e?db.query("INSERT INTO User (fullname, username, email, password, mobile) VALUES (?, ?, ?, ?, ?)",[o,a,t,n,r],function(e,r){return e?(console.error("Error inserting data: ",e),void s.sendFile(path.join(__dirname,"error-500.html"))):void s.send("New user added successfully")}):s.status(400).send("Passwords do not match")}),app.get("/users",function(e,s){db.query("SELECT * FROM User",function(e,r){return e?(console.error("Error fetching data: ",e),void s.sendFile(path.join(__dirname,"error-500.html"))):void s.json(r)})}),app.post("/edit_user/:id",function(e,s){var r=e.params.id,o=e.body,a=o.fullname,t=o.username,e=o.email,o=o.mobile;db.query("UPDATE User SET fullname = ?, username = ?, email = ?, mobile= ? WHERE user_id = ?  ",[a,t,e,o,r],function(e,r){return e?(console.error("Error inserting data:",e),void s.sendFile(path.join(__dirname,"error-500.html"))):void s.send("Changes made succesfully")})}),app.delete("/delete_user/:id",function(e,s){e=e.params.id;db.query("DELETE FROM User WHERE user_id = ?",[e],function(e,r){return e?(console.error("Error inserting data:",e),void s.sendFile(path.join(__dirname,"error-500.html"))):void s.send("Changes made succesfully")})}),app.post("/create-customer",function(e,s){e=e.body,e=[e.customerName,e.legalName,e.mobile,e.contactPerson,e.email,e.address1,e.address2,e.city,e.state,e.pincode,e.gst,e.pan,e.remark,e.bankName,e.accountNo,e.ifscCode,e.balance];db.query("INSERT INTO customers (customerName, legalName, mobile, contactPerson, email, address1, address2, city, state, pincode,\n                 gst, pan, remark, bankName, accountNo, ifscCode, balance)\n                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)",e,function(e,r){return e?(console.error("Database error:",e),void s.status(500).json({success:!1,error:"Database error"})):void s.status(200).json({success:!0})})}),app.get("/customers",function(e,s){db.query("SELECT * FROM customers",function(e,r){return e?(console.log("Errror fetching : ",error),void s.status(500).json({success:!1,error:"Daatabase error"})):void s.json(r)})}),app.get("/edit-customer_page",function(e,r){r.sendFile(path.join(__dirname,"edit-customer.html"))}),app.get("/get_customer/:id",function(e,s){e=e.params.id;db.query("SELECT * FROM customers WHERE id = ?",[e],function(e,r){return e?(console.error("Database error:",e),void s.status(500).json({success:!1,error:"Database error"})):void(0!==r.length?s.json(r[0]):s.status(404).json({success:!1,error:"Customer not found"}))})}),app.put("/edit_customer/:id",function(e,s){var r=e.params.id,e=e.body,r=[e.customerName,e.legalName,e.mobile,e.contactPerson,e.email,e.address1,e.address2,e.city,e.state,e.pincode,e.gst,e.pan,e.remark,e.bankName,e.accountNo,e.ifscCode,e.balance,r];db.query("UPDATE customers SET customerName = ?, legalName = ?, mobile = ?, contactPerson = ?, email = ?, address1 = ?, address2 = ?, city = ?, state = ?, pincode = ?, gst = ?, pan = ?, remark = ?, bankName = ?, accountNo = ?, ifscCode = ?, balance = ? WHERE id = ?",r,function(e,r){return e?(console.error("Database error:",e),void s.status(500).json({success:!1,error:"Database error"})):void s.status(200).json({success:!0})})}),app.delete("/delete_customer/:id",function(e,s){e=e.params.id;db.query("DELETE FROM customers where id = ?",[e],function(e,r){return e?(console.error("Error deleting customer: ",e),void s.status(500).json({success:!1,error:"databse error"})):void s.status(200).json({success:!0})})}),app.get("/view_customer/:id",function(e,s){e=e.params.id;db.query("SELECT * FROM customers WHERE id = ?",[e],function(e,r){return e?(console.error("Database error:",e),void s.status(500).send("Database error")):void s.render("view_customer",{customer:r[0]})})}),app.listen(port,function(){console.log("Listening on port: ".concat(port))});